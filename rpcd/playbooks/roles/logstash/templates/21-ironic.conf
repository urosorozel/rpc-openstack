filter {
  if "ironic" in [tags] {
    grok {
      match => {
       "message" => [ "%{COMMONAPACHELOG}",
                      "\[%{APACHE_ERROR_TIMESTAMP:timestamp}\] \[%{DATA:module}:%{DATA:loglevel}\] \[pid %{POSINT:apache_pid}\:tid %{POSINT:apache_tid}\] ?(?:\[client %{IP:clientip}:%{POSINT:clientport}\]
 )?%{GREEDYDATA:logmessage}" ]
      }
    }

    if ![loglevel]  {
      mutate {
        add_field => { "logmessage" => "%{request}" }
        add_field => { "module" => "ironic.access" }
        add_field => { "loglevel" => "INFO" }
        add_tag => ["ironic-access"]
      }
    } else {
      mutate {
        replace => { "module" => "ironic.error.%{module}" }
        add_tag => [ "ironic-error" ]
        uppercase => [ "loglevel" ]
      }
    }
  }
}
